<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style type="text/css">%1$s</style>
	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script>%2$s</script>
	<![endif]-->
	<style type=text/css>
		#search {
			margin-right: 30px;
		}
	</style>
</head>

<body>
	<div id="search" align="right">
		<label for="packageNameInput" style="font-family: Helvetica, Arial, Verdana, sans-serif;; font-size: 12px;">package:</label>
		<input type="text" id="packageNameInput" size="22" onfocusout="higlightPackageName()" value="">
	</div>
	<div id="chart"></div>
	<script type="text/javascript">%3$s</script>
	<script type="text/javascript">%4$s</script>
	<script type="text/javascript">
	
		var searchPackageName = "";
		var flameGraph;
		var currentJson;
		
		const packageInputField = document.getElementById("packageNameInput");
		packageInputField.addEventListener("keyup", function(event) {
				if(event.keyCode === 13){
					higlightPackageName();	
				}
			}
		);
		
		const tip = d3.tip()
        	.direction("s")
        	.offset([8, 0])
        	.attr('class', 'd3-flame-graph-tip')
        	.html(adjustTip);

		function processGraph(jsonObj) {
			adjustSearchField();
			flameGraph = d3.flamegraph()
				.width(windowAdjustedSize())
				.cellHeight(18)
				.transitionDuration(320)
				.minFrameSize(5)
				.transitionEase(d3.easeCubic)
				.sort(true)
				.title("")
				.differential(false)
				.tooltip(tip)
				.color(colorCell);
			currentJson = jsonObj;
			d3.select("#chart")
				.datum(currentJson)
				.call(flameGraph);
		}

		function higlightPackageName(){
			const inputPackageName = packageInputField.value;
			if(searchPackageName !== inputPackageName){
				searchPackageName = inputPackageName;
				flameGraph.search(searchPackageName);
			}		
		}

		function windowSize() {
			return Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
		}

		function resizeFlameGraph() {
			if (flameGraph) {
				adjustSearchField();
				flameGraph.width(windowAdjustedSize());
				d3.select("#chart")
					.datum(currentJson)
					.call(flameGraph);
			}
		}
		
		function adjustSearchField(){
			document.getElementById("search").style.width = windowAdjustedSize();
		}
		
		function windowAdjustedSize(){
			return windowSize() * 0.95;
		}

	</script>
</body>
</html>